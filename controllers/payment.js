const { result } = require("@hapi/joi/lib/base")
const db = require("../db")
const moment = require("moment")

const addToPayment = async(req,res,next)=>{
    try {
        const uid = res.locals.jwt.userId
        const amount = req.body.amount
        const payment_method = req.body.payment_method
        const status = req.body.status
        const currentDate = moment().format(`YYYY-MM-DD`)
        console.log(currentDate,"currentdate");
        

    const sql = `INSERT INTO payment (user_id, amount, payment_method, status, create_at, update_at) values (?, ?, ?, ?, ?, ?)`
    const value = [uid,amount,payment_method,status,currentDate,currentDate]
    db.query(sql,value,(err,result)=>{
        console.log(err,"err")
        console.log(result,"result");
        if (err){
            res.status(400).send("something error !")
        } else {
            return res.status(200).json({
                status:true,
                data:[],
                msg:"this is payment !"
            })
            
        }
    })
        
    } catch (error) {
        console.log(error);
    }
}



// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//
// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//


const GetPayment = async(req,res,next)=>{
 try {
      const uid = res.locals.jwt.userId
      console.log(uid,"uid");
      const sql = `select * from payment where user_id = ? `
      const value = [uid]
      db.query(sql,value,(err,result1)=>{
        console.log(err,"err");
        console.log(result1,"result1");
        if(err){
            res.status(400).json({
              status:false,
              data:[],
              msg:"something error"
            })
        }else{
            return res.status(200).json({
                status:true,
                data:[],
                msg:" YE PAYMENT HAI ! "
            })
        }
 })

 } catch (error) {
console.log(error);
 }

}

// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//
// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//


module.exports = {addToPayment,GetPayment}